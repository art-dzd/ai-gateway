<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light" />
    <title>AI Gateway — Дашборд</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Golos+Text:wght@400;600;700&family=IBM+Plex+Mono:wght@400;600&display=swap");

      :root {
        --bg: #f6f2e8;
        --ink: #0c1423;
        --muted: rgba(12, 20, 35, 0.62);
        --line: rgba(12, 20, 35, 0.12);
        --panel: rgba(255, 255, 255, 0.62);
        --panel-2: rgba(255, 255, 255, 0.78);
        --shadow: 0 24px 70px rgba(12, 20, 35, 0.12);

        --ok: #0f766e;
        --bad: #b42318;
        --warn: #b45309;
        --idle: rgba(12, 20, 35, 0.55);

        --font-display: "Golos Text", ui-sans-serif, system-ui, -apple-system, "Segoe UI", sans-serif;
        --font-sans: "Golos Text", ui-sans-serif, system-ui, -apple-system, "Segoe UI", sans-serif;
        --font-mono: "IBM Plex Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        color: var(--ink);
        font-family: var(--font-sans);
        background: radial-gradient(900px 520px at 14% 12%, rgba(15, 118, 110, 0.12), transparent 62%),
          radial-gradient(1000px 560px at 90% 14%, rgba(37, 99, 235, 0.09), transparent 60%),
          radial-gradient(900px 520px at 50% 112%, rgba(180, 83, 9, 0.08), transparent 62%),
          linear-gradient(180deg, #faf7f1, var(--bg));
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background-image: linear-gradient(to right, rgba(12, 20, 35, 0.05) 1px, transparent 1px),
          linear-gradient(to bottom, rgba(12, 20, 35, 0.05) 1px, transparent 1px),
          radial-gradient(1200px 560px at 50% -10%, rgba(12, 20, 35, 0.06), transparent 65%);
        background-size: 42px 42px, 42px 42px, auto;
        opacity: 0.38;
      }

      .wrap {
        max-width: 1280px;
        margin: 0 auto;
        padding: 20px 16px 64px;
        position: relative;
        z-index: 1;
      }

      header {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        gap: 12px;
        flex-wrap: wrap;
        padding: 16px 18px;
        border: 1px solid var(--line);
        border-radius: 22px;
        background: linear-gradient(180deg, var(--panel-2), var(--panel));
        box-shadow: var(--shadow);
        backdrop-filter: blur(10px);
      }

      h1 {
        margin: 0;
        font-family: var(--font-display);
        font-size: 26px;
        letter-spacing: -0.02em;
        line-height: 1.05;
      }

      .subtitle {
        margin-top: 6px;
        font-size: 12px;
        line-height: 1.35;
        color: var(--muted);
        max-width: 80ch;
      }

      .mono {
        font-family: var(--font-mono);
        font-variant-ligatures: none;
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-end;
        gap: 8px;
      }

      .chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 999px;
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.5);
        color: rgba(12, 20, 35, 0.9);
        text-decoration: none;
        font-size: 12px;
        transition: transform 160ms ease, background 160ms ease, border-color 160ms ease;
        will-change: transform;
      }

      .chip:hover {
        transform: translateY(-1px);
        background: rgba(255, 255, 255, 0.78);
        border-color: rgba(12, 20, 35, 0.18);
      }

      .chip:focus-visible {
        outline: 2px solid rgba(37, 99, 235, 0.55);
        outline-offset: 3px;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 12px;
        margin-top: 12px;
      }

      @media (max-width: 900px) {
        .stats {
          grid-template-columns: 1fr;
        }
      }

      .stat {
        border: 1px solid var(--line);
        border-radius: 20px;
        background: var(--panel);
        box-shadow: 0 18px 55px rgba(12, 20, 35, 0.08);
        padding: 12px 14px;
        backdrop-filter: blur(10px);
      }

      .stat .k {
        font-size: 12px;
        color: var(--muted);
      }

      .stat .v {
        margin-top: 8px;
        font-family: var(--font-display);
        font-size: 30px;
        font-weight: 700;
        line-height: 1;
      }

      .stat .d {
        margin-top: 8px;
        font-size: 12px;
        color: var(--muted);
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
        margin-top: 12px;
      }

      @media (min-width: 1100px) {
        .grid {
          grid-template-columns: minmax(0, 2fr) minmax(0, 1fr);
          align-items: start;
        }
      }

      .span-all {
        grid-column: 1 / -1;
      }

      section.panel {
        border: 1px solid var(--line);
        border-radius: 22px;
        background: var(--panel);
        box-shadow: var(--shadow);
        overflow: hidden;
        backdrop-filter: blur(10px);
      }

      .panel__head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 12px 14px;
        border-bottom: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.58);
      }

      .panel__head h2 {
        margin: 0;
        font-family: var(--font-display);
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
      }

      .count {
        font-family: var(--font-mono);
        font-size: 12px;
        color: var(--muted);
        padding: 2px 8px;
        border: 1px solid var(--line);
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.5);
      }

      .list {
        padding: 6px;
      }

      .empty {
        padding: 14px;
        font-size: 12px;
        color: var(--muted);
      }

      details.item {
        margin: 8px;
        border: 1px solid rgba(12, 20, 35, 0.14);
        border-radius: 18px;
        background: rgba(255, 255, 255, 0.64);
        overflow: hidden;
      }

      details.item[open] {
        border-color: rgba(15, 118, 110, 0.25);
        background: rgba(255, 255, 255, 0.78);
        box-shadow: 0 20px 60px rgba(12, 20, 35, 0.08);
      }

      details.item > summary {
        cursor: pointer;
        padding: 10px 12px;
        list-style: none;
        display: grid;
        grid-template-columns: 96px minmax(0, 1fr) auto 18px;
        grid-template-areas: "time core metrics chev";
        align-items: center;
        gap: 10px;
        user-select: none;
      }

      details.item > summary::-webkit-details-marker {
        display: none;
      }

      details.item > summary:focus-visible {
        outline: 2px solid rgba(37, 99, 235, 0.55);
        outline-offset: 3px;
        border-radius: 14px;
      }

      @media (max-width: 860px) {
        details.item > summary {
          grid-template-columns: 96px minmax(0, 1fr) 18px;
          grid-template-areas:
            "time core chev"
            "time metrics chev";
          align-items: start;
        }
      }

      .time {
        grid-area: time;
        font-family: var(--font-mono);
        font-size: 11px;
        color: var(--muted);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .core {
        grid-area: core;
        min-width: 0;
        display: flex;
        flex-wrap: wrap;
        align-items: baseline;
        gap: 6px 10px;
      }

      .kind {
        font-family: var(--font-mono);
        font-size: 11px;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid rgba(12, 20, 35, 0.12);
        background: rgba(12, 20, 35, 0.03);
        color: rgba(12, 20, 35, 0.85);
        white-space: nowrap;
      }

      .provider {
        font-weight: 600;
        color: rgba(12, 20, 35, 0.95);
        white-space: nowrap;
      }

      .model {
        font-family: var(--font-mono);
        font-size: 11px;
        color: var(--muted);
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .metrics {
        grid-area: metrics;
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-end;
        gap: 8px;
        align-items: center;
      }

      @media (max-width: 860px) {
        .metrics {
          justify-content: flex-start;
        }
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 3px 10px;
        border-radius: 999px;
        border: 1px solid rgba(12, 20, 35, 0.14);
        background: rgba(255, 255, 255, 0.6);
        font-family: var(--font-mono);
        font-size: 11px;
        white-space: nowrap;
      }

      .pill::before {
        content: "";
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: currentColor;
        box-shadow: 0 0 0 3px rgba(12, 20, 35, 0.06);
      }

      .pill--ok {
        color: var(--ok);
        border-color: rgba(15, 118, 110, 0.22);
        background: rgba(15, 118, 110, 0.08);
      }

      .pill--bad {
        color: var(--bad);
        border-color: rgba(180, 35, 24, 0.22);
        background: rgba(180, 35, 24, 0.08);
      }

      .pill--warn {
        color: var(--warn);
        border-color: rgba(180, 83, 9, 0.22);
        background: rgba(180, 83, 9, 0.08);
      }

      .pill--idle {
        color: var(--idle);
        border-color: rgba(12, 20, 35, 0.14);
        background: rgba(12, 20, 35, 0.04);
      }

      .num {
        font-family: var(--font-mono);
        font-size: 11px;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid rgba(12, 20, 35, 0.12);
        background: rgba(12, 20, 35, 0.03);
        color: rgba(12, 20, 35, 0.92);
        white-space: nowrap;
      }

      .chev {
        grid-area: chev;
        display: inline-block;
        font-family: var(--font-mono);
        color: var(--muted);
        transform-origin: 50% 50%;
        transition: transform 180ms ease;
      }

      details.item[open] .chev {
        transform: rotate(180deg);
      }

      .body {
        padding: 12px;
        border-top: 1px solid rgba(12, 20, 35, 0.1);
        background: rgba(255, 255, 255, 0.4);
      }

      .kvgrid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 10px;
      }

      @media (max-width: 980px) {
        .kvgrid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      @media (max-width: 620px) {
        .kvgrid {
          grid-template-columns: 1fr;
        }
      }

      .kv {
        border: 1px solid rgba(12, 20, 35, 0.12);
        background: rgba(255, 255, 255, 0.58);
        border-radius: 16px;
        padding: 8px 10px;
        overflow: hidden;
      }

      .kv .k {
        color: var(--muted);
        font-size: 11px;
      }

      .kv .v {
        margin-top: 4px;
        font-family: var(--font-mono);
        font-size: 12px;
        color: rgba(12, 20, 35, 0.92);
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .errorbox {
        margin-top: 10px;
        border: 1px solid rgba(180, 35, 24, 0.25);
        background: rgba(180, 35, 24, 0.06);
        border-radius: 16px;
        padding: 10px 12px;
      }

      .errorbox .k {
        color: rgba(180, 35, 24, 0.92);
        font-size: 11px;
        font-family: var(--font-mono);
      }

      .errorbox .v {
        margin-top: 6px;
        color: rgba(12, 20, 35, 0.92);
        font-size: 12px;
        word-break: break-word;
      }

      details.subdetails {
        margin-top: 10px;
        border: 1px solid rgba(12, 20, 35, 0.12);
        border-radius: 16px;
        background: rgba(12, 20, 35, 0.03);
        overflow: hidden;
      }

      details.subdetails > summary {
        cursor: pointer;
        padding: 9px 10px;
        list-style: none;
        user-select: none;
        font-family: var(--font-mono);
        font-size: 11px;
        color: var(--muted);
      }

      details.subdetails > summary::-webkit-details-marker {
        display: none;
      }

      details.subdetails[open] > summary {
        border-bottom: 1px solid rgba(12, 20, 35, 0.12);
        background: rgba(255, 255, 255, 0.55);
      }

      pre.code {
        margin: 0;
        padding: 10px;
        max-height: 320px;
        overflow: auto;
        white-space: pre-wrap;
        word-break: break-word;
        font-family: var(--font-mono);
        font-size: 11px;
        color: rgba(12, 20, 35, 0.92);
      }

      @media (prefers-reduced-motion: no-preference) {
        header,
        .stat,
        section.panel {
          animation: enter 520ms cubic-bezier(0.2, 0.8, 0.2, 1) both;
        }
        .stat:nth-child(2) {
          animation-delay: 60ms;
        }
        .stat:nth-child(3) {
          animation-delay: 120ms;
        }
        section.panel:nth-of-type(1) {
          animation-delay: 90ms;
        }
        section.panel:nth-of-type(2) {
          animation-delay: 140ms;
        }
        section.panel:nth-of-type(3) {
          animation-delay: 190ms;
        }
      }

      @keyframes enter {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div>
          <h1>AI Gateway</h1>
          <div class="subtitle">
            Последние запросы, задачи и вебхуки. Кликни по строке, чтобы раскрыть детали (ID, ошибки,
            редактированный payload, сводка ответа).
          </div>
        </div>
        <div class="actions">
          <a class="chip" href="/healthz">/healthz</a>
          <a class="chip" href="/readyz">/readyz</a>
          <a class="chip" href="/metrics">/metrics</a>
          <a class="chip" href="/dashboard/data">/dashboard/data</a>
        </div>
      </header>

      <section class="stats" aria-label="Сводка">
        <div class="stat">
          <div class="k">Запросы (последние)</div>
          <div class="v">{{ data.requests | length }}</div>
          <div class="d">OK: {{ data.stats.requests_ok }}, ошибки: {{ data.stats.requests_err }}.</div>
        </div>
        <div class="stat">
          <div class="k">Задачи (последние)</div>
          <div class="v">{{ data.jobs | length }}</div>
          <div class="d">
            в очереди: {{ data.stats.jobs_queued }}, в работе: {{ data.stats.jobs_running }}, OK:
            {{ data.stats.jobs_ok }}, ошибки: {{ data.stats.jobs_err }}.
          </div>
        </div>
        <div class="stat">
          <div class="k">Вебхуки (последние)</div>
          <div class="v">{{ data.webhooks | length }}</div>
          <div class="d">OK: {{ data.stats.webhooks_ok }}, ошибки: {{ data.stats.webhooks_err }}.</div>
        </div>
      </section>

      <div class="grid">
        <section class="panel">
          <div class="panel__head">
            <h2>Запросы</h2>
            <span class="count">{{ data.requests | length }}</span>
          </div>
          <div class="list">
            {% if data.requests %}
            {% for r in data.requests %}
            {% set s = r.status %}
            {% set ts = r.created_at.replace('T',' ') %}
            <details class="item">
              <summary>
                <span class="time" title="{{ ts }}">{{ ts[5:19] }}</span>
                <span class="core">
                  <span class="kind">{{ r.kind }}</span>
                  <span class="provider">{{ r.provider }}</span>
                  <span class="model" title="{{ r.model or '-' }}">{{ r.model or '-' }}</span>
                </span>
                <span class="metrics">
                  <span class="pill {{ 'pill--ok' if s == 'succeeded' else 'pill--bad' }}" title="{{ s }}">
                    {{ 'успешно' if s == 'succeeded' else 'ошибка' }}
                  </span>
                  <span class="num">lat: {{ r.latency_ms }}мс</span>
                  <span class="num">tok: {{ r.total_tokens if r.total_tokens is not none else '-' }}</span>
                  <span class="num">₽: {{ r.cost_rub if r.cost_rub is not none else '-' }}</span>
                </span>
                <span class="chev" aria-hidden="true">▾</span>
              </summary>
              <div class="body">
                <div class="kvgrid">
                  <div class="kv">
                    <div class="k">request_id</div>
                    <div class="v" title="{{ r.id }}">{{ r.id }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">api_key_id</div>
                    <div class="v" title="{{ r.api_key_id }}">{{ r.api_key_id[:8] }}…</div>
                  </div>
                  <div class="kv">
                    <div class="k">время</div>
                    <div class="v" title="{{ ts }}">{{ ts }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">tokens</div>
                    <div class="v">
                      {{ r.prompt_tokens if r.prompt_tokens is not none else '-' }}
                      +
                      {{ r.completion_tokens if r.completion_tokens is not none else '-' }}
                      =
                      {{ r.total_tokens if r.total_tokens is not none else '-' }}
                    </div>
                  </div>
                  <div class="kv">
                    <div class="k">latency</div>
                    <div class="v">{{ r.latency_ms }}мс</div>
                  </div>
                  <div class="kv">
                    <div class="k">стоимость (RUB)</div>
                    <div class="v">{{ r.cost_rub if r.cost_rub is not none else '-' }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">kind</div>
                    <div class="v">{{ r.kind }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">провайдер / модель</div>
                    <div class="v">{{ r.provider }} / {{ r.model or '-' }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">status</div>
                    <div class="v">{{ r.status }}</div>
                  </div>
                </div>

                {% if r.error_code or r.error_text %}
                <div class="errorbox">
                  <div class="k">ошибка: {{ r.error_code or 'unknown' }}</div>
                  <div class="v">{{ r.error_text or '-' }}</div>
                </div>
                {% endif %}

                <details class="subdetails">
                  <summary>payload (редакт.)</summary>
                  <pre class="code">{{ (r.request_payload or {}) | tojson(indent=2) }}</pre>
                </details>
                <details class="subdetails">
                  <summary>ответ (сводка)</summary>
                  <pre class="code">{{ (r.response_payload or {}) | tojson(indent=2) }}</pre>
                </details>
              </div>
            </details>
            {% endfor %}
            {% else %}
            <div class="empty">Пока нет запросов.</div>
            {% endif %}
          </div>
        </section>

        <section class="panel">
          <div class="panel__head">
            <h2>Задачи</h2>
            <span class="count">{{ data.jobs | length }}</span>
          </div>
          <div class="list">
            {% if data.jobs %}
            {% for j in data.jobs %}
            {% set s = j.status %}
            {% set ts = j.created_at.replace('T',' ') %}
            <details class="item">
              <summary>
                <span class="time" title="{{ ts }}">{{ ts[5:19] }}</span>
                <span class="core">
                  <span class="kind">{{ j.kind }}</span>
                  <span class="provider">{{ j.provider }}</span>
                  <span class="model" title="{{ j.model or '-' }}">{{ j.model or '-' }}</span>
                </span>
                <span class="metrics">
                  {% if s == 'succeeded' %}
                    <span class="pill pill--ok" title="{{ s }}">готово</span>
                  {% elif s == 'failed' %}
                    <span class="pill pill--bad" title="{{ s }}">ошибка</span>
                  {% elif s == 'running' %}
                    <span class="pill pill--warn" title="{{ s }}">в работе</span>
                  {% else %}
                    <span class="pill pill--idle" title="{{ s }}">в очереди</span>
                  {% endif %}
                  <span class="num">webhook: {{ 'да' if j.webhook_url else 'нет' }}</span>
                </span>
                <span class="chev" aria-hidden="true">▾</span>
              </summary>
              <div class="body">
                <div class="kvgrid">
                  <div class="kv">
                    <div class="k">job_id</div>
                    <div class="v" title="{{ j.id }}">{{ j.id }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">api_key_id</div>
                    <div class="v" title="{{ j.api_key_id }}">{{ j.api_key_id[:8] }}…</div>
                  </div>
                  <div class="kv">
                    <div class="k">создано</div>
                    <div class="v" title="{{ ts }}">{{ ts }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">обновлено</div>
                    <div class="v">{{ j.updated_at.replace('T',' ') if j.updated_at else '-' }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">status</div>
                    <div class="v">{{ j.status }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">провайдер / модель</div>
                    <div class="v">{{ j.provider }} / {{ j.model or '-' }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">idempotency_key</div>
                    <div class="v" title="{{ j.idempotency_key }}">{{ j.idempotency_key or '-' }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">вебхук</div>
                    <div class="v" title="{{ j.webhook_url }}">{{ j.webhook_url or 'нет' }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">секрет вебхука</div>
                    <div class="v">{{ 'да' if j.webhook_secret_set else 'нет' }}</div>
                  </div>
                </div>

                {% if j.error_code or j.error_text %}
                <div class="errorbox">
                  <div class="k">ошибка: {{ j.error_code or 'unknown' }}</div>
                  <div class="v">{{ j.error_text or '-' }}</div>
                </div>
                {% endif %}

                <details class="subdetails">
                  <summary>payload (редакт.)</summary>
                  <pre class="code">{{ (j.payload or {}) | tojson(indent=2) }}</pre>
                </details>
                <details class="subdetails">
                  <summary>результат (редакт.)</summary>
                  <pre class="code">{{ (j.result or {}) | tojson(indent=2) }}</pre>
                </details>
                <details class="subdetails">
                  <summary>заголовки вебхука</summary>
                  <pre class="code">{{ (j.webhook_headers or {}) | tojson(indent=2) }}</pre>
                </details>
              </div>
            </details>
            {% endfor %}
            {% else %}
            <div class="empty">Пока нет задач.</div>
            {% endif %}
          </div>
        </section>

        <section class="panel span-all">
          <div class="panel__head">
            <h2>Вебхуки</h2>
            <span class="count">{{ data.webhooks | length }}</span>
          </div>
          <div class="list">
            {% if data.webhooks %}
            {% for w in data.webhooks %}
            {% set ts = w.created_at.replace('T',' ') %}
            <details class="item">
              <summary>
                <span class="time" title="{{ ts }}">{{ ts[5:19] }}</span>
                <span class="core">
                  <span class="kind">delivery</span>
                  <span class="provider mono" title="{{ w.job_id }}">{{ w.job_id[:8] }}</span>
                  <span class="model" title="{{ w.url }}">{{ w.url }}</span>
                </span>
                <span class="metrics">
                  {% if w.status_code and w.status_code < 300 %}
                    <span class="pill pill--ok" title="{{ w.status_code }}">{{ w.status_code }}</span>
                  {% else %}
                    <span class="pill pill--bad" title="{{ w.status_code }}">{{ w.status_code or '-' }}</span>
                  {% endif %}
                  <span class="num">try: {{ w.attempt }}</span>
                  <span class="num">lat: {{ w.latency_ms if w.latency_ms is not none else '-' }}мс</span>
                </span>
                <span class="chev" aria-hidden="true">▾</span>
              </summary>
              <div class="body">
                <div class="kvgrid">
                  <div class="kv">
                    <div class="k">delivery_id</div>
                    <div class="v" title="{{ w.id }}">{{ w.id }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">job_id</div>
                    <div class="v" title="{{ w.job_id }}">{{ w.job_id }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">attempt</div>
                    <div class="v">{{ w.attempt }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">status_code</div>
                    <div class="v">{{ w.status_code if w.status_code is not none else '-' }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">latency</div>
                    <div class="v">{{ w.latency_ms if w.latency_ms is not none else '-' }}мс</div>
                  </div>
                  <div class="kv">
                    <div class="k">время</div>
                    <div class="v" title="{{ ts }}">{{ ts }}</div>
                  </div>
                  <div class="kv">
                    <div class="k">url</div>
                    <div class="v" title="{{ w.url }}">{{ w.url }}</div>
                  </div>
                </div>

                {% if w.error_text %}
                <div class="errorbox">
                  <div class="k">ошибка</div>
                  <div class="v">{{ w.error_text }}</div>
                </div>
                {% endif %}
              </div>
            </details>
            {% endfor %}
            {% else %}
            <div class="empty">Пока нет доставок.</div>
            {% endif %}
          </div>
        </section>
      </div>
    </div>
  </body>
</html>
